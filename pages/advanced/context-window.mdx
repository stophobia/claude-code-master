import { Callout } from 'nextra/components'

# 컨텍스트 윈도우 관리

Claude Code의 컨텍스트 윈도우를 효율적으로 관리하여 최적의 성능을 유지하는 방법입니다.

## 컨텍스트 윈도우란?

컨텍스트 윈도우는 Claude가 한 번에 처리할 수 있는 텍스트의 양입니다. 이 공간에는:

- 대화 히스토리
- 읽은 파일 내용
- 도구 결과
- 시스템 프롬프트
- MCP 도구 정의

가 모두 포함됩니다.

## 컨텍스트 윈도우 크기

| 모델 | 기본 크기 | MCP 활성화 시 |
|------|----------|--------------|
| Claude Opus 4.5 | 200k | ~70k (MCP 과다 시) |
| Claude Sonnet 4.5 | 200k | ~70k (MCP 과다 시) |
| Claude Haiku 4.5 | 200k | ~70k (MCP 과다 시) |

<Callout type="warning">
  MCP를 너무 많이 활성화하면 컨텍스트 윈도우가 70k로 줄어들 수 있습니다!
</Callout>

## 컨텍스트 민감도

### 높은 민감도 작업 (마지막 20%에서 피하기)

<Callout type="error">
  컨텍스트 윈도우의 **마지막 20%**에서는 복잡한 작업을 피하세요!
</Callout>

- 대규모 리팩토링
- 여러 파일에 걸친 기능 구현
- 복잡한 상호작용 디버깅
- 아키텍처 설계 작업

### 낮은 민감도 작업 (언제든 안전)

- 단일 파일 편집
- 독립적인 유틸리티 생성
- 문서 업데이트
- 간단한 버그 수정
- 코드 리뷰

## 컨텍스트 관리 전략

### 1. 새 세션 시작

복잡한 작업 전에 새 세션을 시작하세요.

```bash
# 새 세션 시작
claude

# 또는 /clear 명령어 사용
/clear
```

### 2. 파일 읽기 최적화

```typescript
// 나쁨: 전체 파일 읽기
Read("src/components/index.ts")  // 1000줄 파일

// 좋음: 필요한 부분만 읽기
Read("src/components/Button.tsx", { offset: 50, limit: 100 })
```

### 3. 검색 대신 에이전트 사용

대규모 검색 작업에는 에이전트를 사용하세요.

```
좋음: "Explore 에이전트를 사용하여 인증 관련 코드 찾기"
나쁨: 여러 Grep/Glob 명령어 직접 실행
```

### 4. MCP 서버 최적화

| 항목 | 권장 |
|------|------|
| 설정해둘 MCP 수 | 20-30개 |
| 프로젝트당 활성화 | 10개 미만 |
| 활성 도구 수 | 80개 미만 |

```json
{
  "disabledMcpServers": [
    "unused-server-1",
    "unused-server-2"
  ]
}
```

## 모델 선택 전략

### 작업별 권장 모델

| 작업 | 권장 모델 | 이유 |
|------|----------|------|
| 경량 에이전트 | Haiku 4.5 | 비용 3배 절감, 빠른 응답 |
| 메인 개발 | Sonnet 4.5 | 최고의 코딩 능력 |
| 아키텍처 결정 | Opus 4.5 | 가장 깊은 추론 |

### Haiku 적합 작업

- 자주 호출되는 경량 에이전트
- 페어 프로그래밍과 코드 생성
- 멀티 에이전트 시스템의 워커 에이전트

### Sonnet 적합 작업

- 메인 개발 작업
- 멀티 에이전트 워크플로우 오케스트레이션
- 복잡한 코딩 작업

### Opus 적합 작업

- 복잡한 아키텍처 결정
- 최대 추론 요구사항
- 리서치 및 분석 작업

## Ultrathink + Plan Mode

깊은 추론이 필요한 복잡한 작업:

1. 향상된 사고를 위해 `ultrathink` 사용
2. 구조화된 접근을 위해 **Plan Mode** 활성화
3. 여러 번의 비평 라운드로 "엔진 예열"
4. 다양한 분석을 위해 역할 분리 서브 에이전트 사용

```
ultrathink를 사용하여 이 아키텍처를 분석해줘
```

## 컨텍스트 사용량 모니터링

### 시각적 표시

Claude Code는 컨텍스트 사용량을 시각적으로 표시합니다:

- **녹색**: 충분한 여유 공간
- **노란색**: 주의 필요
- **빨간색**: 새 세션 권장

### 권장 조치

| 상태 | 조치 |
|------|------|
| 0-60% | 정상 작업 |
| 60-80% | 복잡한 작업 완료 |
| 80-100% | 새 세션 시작 권장 |

## 빌드 문제 해결

빌드 실패 시 컨텍스트 효율적 접근:

1. **build-error-resolver** 에이전트 사용
2. 오류 메시지만 분석 (전체 로그 아님)
3. 점진적으로 수정
4. 각 수정 후 검증

## 베스트 프랙티스

### DO

- 복잡한 작업 전 새 세션 시작
- 에이전트를 활용하여 검색 수행
- 필요한 파일 부분만 읽기
- 사용하지 않는 MCP 비활성화

### DON'T

- 컨텍스트 80%+ 에서 대규모 리팩토링
- 불필요한 파일 전체 읽기
- 모든 MCP 서버 활성화
- 하나의 세션에서 너무 많은 작업
